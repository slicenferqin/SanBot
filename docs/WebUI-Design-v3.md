# SanBot WebUI v3 设计文档

> 设计理念：现代、克制、有温度 —— 专业但不冷漠，简洁但不简陋

## 1. 设计原则

### 1.1 核心原则

| 原则 | 说明 |
|------|------|
| **清晰优先** | 信息层级分明，用户一眼能找到需要的内容 |
| **有呼吸感** | 适当留白，元素之间有舒适的间距 |
| **反馈及时** | 每个操作都有明确的视觉反馈 |
| **包容性** | 同时服务专业用户和普通用户 |

### 1.2 参考产品

- **ChatGPT** - 对话体验、消息气泡
- **Linear** - 视觉克制、键盘支持
- **Notion** - 留白、呼吸感
- **Arc** - 现代感、微交互

### 1.3 与 v2 的主要区别

| 方面 | v2 | v3 |
|------|----|----|
| 视觉风格 | 玻璃拟态、渐变 | 扁平、微妙层次 |
| 布局 | 紧凑 | 舒适留白 |
| 动效 | 过多 | 克制但有 |
| 字体 | Space Grotesk | Geist |
| 交互 | 仅键盘 | 键盘 + 鼠标友好 |

---

## 2. 配色系统

### 2.1 深色主题（唯一主题）

不提供浅色主题。开发工具深色更护眼，也更专业。

```css
:root {
  /* 背景层次 - 微妙的灰度差异 */
  --bg-0: #0a0a0a;          /* 最深，页面背景 */
  --bg-1: #111111;          /* 侧边栏、卡片 */
  --bg-2: #191919;          /* 输入框、悬停 */
  --bg-3: #222222;          /* 激活状态 */

  /* 文字层次 */
  --text-1: #fafafa;        /* 主要文字 */
  --text-2: #a0a0a0;        /* 次要文字 */
  --text-3: #666666;        /* 辅助文字 */
  --text-4: #444444;        /* 禁用文字 */

  /* 边框 - 极低对比度 */
  --border-1: #222222;      /* 主要边框 */
  --border-2: #333333;      /* 强调边框 */

  /* 语义色 - 低饱和度 */
  --accent: #3b82f6;        /* 主强调色 - 蓝 */
  --success: #22c55e;       /* 成功 - 绿 */
  --warning: #eab308;       /* 警告 - 黄 */
  --error: #ef4444;         /* 错误 - 红 */
  --info: #8b5cf6;          /* 信息 - 紫 */
}
```

### 2.2 配色使用规则

1. **背景**：只用 `--bg-0` 到 `--bg-3`，通过微妙灰度差异区分层级
2. **文字**：主要内容用 `--text-1`，元数据用 `--text-2`，占位符用 `--text-3`
3. **强调色**：仅用于可交互元素和状态指示，不用于装饰
4. **边框**：尽量少用，用背景色差异代替

---

## 3. 字体系统

### 3.1 字体选择

```css
:root {
  /* 界面字体 - Geist Sans */
  --font-sans: "Geist", -apple-system, BlinkMacSystemFont, sans-serif;

  /* 代码字体 - Geist Mono */
  --font-mono: "Geist Mono", "SF Mono", "Consolas", monospace;

  /* 中文回退 */
  --font-cjk: "PingFang SC", "Microsoft YaHei", sans-serif;
}
```

**为什么选 Geist**：
- Vercel 出品，专为开发者设计
- 现代、清晰、高可读性
- Sans 和 Mono 风格统一
- 免费开源

### 3.2 字号系统

```css
:root {
  --text-xs: 11px;          /* 时间戳、徽章 */
  --text-sm: 12px;          /* 次要信息 */
  --text-base: 13px;        /* 正文 */
  --text-lg: 14px;          /* 标题 */
  --text-xl: 16px;          /* 大标题 */
}
```

**注意**：整体字号偏小，符合高信息密度的设计目标。

### 3.3 行高

```css
:root {
  --leading-tight: 1.3;     /* 标题 */
  --leading-normal: 1.5;    /* 正文 */
  --leading-relaxed: 1.7;   /* 代码块 */
}
```

---

## 4. 间距系统

### 4.1 基础间距

```css
:root {
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-6: 24px;
  --space-8: 32px;
}
```

### 4.2 使用规则

- **元素内部**：`--space-1` 到 `--space-2`
- **元素之间**：`--space-2` 到 `--space-3`
- **区块之间**：`--space-4` 到 `--space-6`
- **页面边距**：`--space-4`

---

## 5. 布局设计

### 5.1 整体结构

```
┌─────────────────────────────────────────────────────────────┐
│ Header (40px)                                               │
├──────────────┬──────────────────────────────────────────────┤
│              │                                              │
│  Sidebar     │  Main Content                                │
│  (220px)     │                                              │
│              │                                              │
│              ├──────────────────────────────────────────────┤
│              │  Input (auto)                                │
└──────────────┴──────────────────────────────────────────────┘
```

### 5.2 Header (40px)

```
┌─────────────────────────────────────────────────────────────┐
│ ◉ SanBot    │ claude-sonnet-4 ▾ │           ● Connected │
└─────────────────────────────────────────────────────────────┘

- 左：Logo + 名称
- 中：模型选择器（下拉）
- 右：连接状态
```

### 5.3 Sidebar (220px)

```
┌──────────────┐
│ + New Chat   │  新建按钮
├──────────────┤
│ Today        │  分组标题
│  ├ Chat 1    │  会话项
│  └ Chat 2 ●  │  ● 表示活跃
├──────────────┤
│ Yesterday    │
│  └ Chat 3    │
├──────────────┤
│ ⌘K Search    │  底部快捷键提示
└──────────────┘

- 宽度固定 220px
- 可通过 ⌘B 折叠为 0
- 会话项单行显示，超长截断
```

### 5.4 Main Content

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│  You                                              10:30 AM   │
│  重构 WebUI                                                  │
│                                                              │
│  ────────────────────────────────────────────────────────    │
│                                                              │
│  SanBot                                           10:30 AM   │
│  我来帮你重构...                                             │
│                                                              │
│  ┌─ Tools (2/4) ──────────────────────────────────────────┐  │
│  │ ✓ read_file    index.html                       120ms │  │
│  │ ● exec         bun test                      running  │  │
│  │ ○ write_file   new.html                       pending │  │
│  │ ○ exec         git add                        pending │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
└──────────────────────────────────────────────────────────────┘

- 消息之间用细线分隔，不用卡片
- 工具调用内嵌在消息中
- 时间戳右对齐，使用 --text-3 颜色
```

### 5.5 Input Area

```
┌──────────────────────────────────────────────────────────────┐
│ │ Message...                                      [↑] [⌘↵]  │
└──────────────────────────────────────────────────────────────┘

- 单行输入框，自动扩展到最多 5 行
- 右侧按钮组：
  - [↑] 发送按钮（有内容时高亮为 --accent）
  - 悬停显示快捷键提示 "⌘↵"
- 聚焦时边框变为 --accent
- 发送按钮对普通用户友好，快捷键对专业用户高效
```

---

## 6. 组件设计

### 6.1 消息

#### 用户消息

```
You                                                  10:30 AM
重构 WebUI，参考 Linear 的设计风格
```

- 无背景色，无边框
- 角色名 `--text-2`，内容 `--text-1`
- 时间戳 `--text-3`，右对齐

#### AI 消息

```
SanBot                                               10:30 AM
我来帮你重构 WebUI。首先分析现有实现...

┌─ Tools (2/4) ─────────────────────────────────────────────┐
│ ✓ read_file    index.html                          120ms │
│ ● exec         bun test                         running  │
└───────────────────────────────────────────────────────────┘

根据分析，主要问题是...
```

- 工具调用区块使用 `--bg-1` 背景
- 工具区块可折叠

### 6.2 工具调用

#### 状态图标

```
✓  成功    --success
●  进行中  --warning (无动画)
○  等待    --text-4
✗  失败    --error
```

#### 工具行格式

```
[状态] [工具名]     [参数摘要]                    [耗时/状态]
  ✓   read_file    src/index.ts                      120ms
  ●   exec         bun test                       running
  ✗   write_file   output.json              error: EACCES
```

- 工具名等宽，参数摘要截断
- 点击展开详情（输入/输出）

#### 展开详情

```
┌─ exec ────────────────────────────────────────────────────┐
│ $ bun test                                                │
├───────────────────────────────────────────────────────────┤
│ bun test v1.0.0                                          │
│                                                           │
│  ✓ tests/foo.test.ts (3)                                 │
│  ✓ tests/bar.test.ts (5)                                 │
│                                                           │
│  8 pass | 0 fail                                         │
└───────────────────────────────────────────────────────────┘
```

- 输入用 `$` 前缀
- 输出用等宽字体
- 背景 `--bg-2`

### 6.3 会话列表项

```
Chat title here...                                      10:30
```

- 单行，超长用 `...` 截断
- 悬停显示 `--bg-2` 背景
- 选中显示 `--bg-3` 背景 + 左侧 2px `--accent` 边框
- 右键显示上下文菜单（重命名、删除）

### 6.4 模型选择器

```
┌─────────────────────┐
│ claude-sonnet-4  ▾  │
└─────────────────────┘
        │
        ▼
┌─────────────────────┐
│ claude-sonnet-4   ✓ │
│ claude-opus-4       │
│ gpt-4o              │
│ ─────────────────── │
│ + Add provider...   │
└─────────────────────┘
```

- 下拉菜单，当前选中显示 ✓
- 底部可添加新服务商

### 6.5 连接状态

```
● Connected      绿点 + 文字
○ Connecting...  灰点 + 文字
● Disconnected   红点 + 文字
```

- 使用圆点而非图标
- 断开时显示重连按钮

---

## 7. 交互设计

### 7.1 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| `⌘ K` | 全局搜索 |
| `⌘ N` | 新建会话 |
| `⌘ B` | 切换侧边栏 |
| `⌘ ↵` | 发送消息 |
| `⌘ .` | 停止生成 |
| `↑` | 编辑上条消息（输入框为空时） |
| `Esc` | 关闭弹窗/取消 |

### 7.2 状态反馈

#### 发送消息

1. 按下 `⌘↵` 或点击发送按钮
2. 消息淡入出现在对话流（乐观更新）
3. 输入框清空并禁用
4. AI 消息区域显示 `SanBot is thinking...▌`
5. 流式输出开始，文字逐步出现
6. 完成后输入框恢复

#### 工具调用

1. 工具区块出现，状态为 `○ pending`
2. 开始执行，状态变为 `● running`
3. 完成，状态变为 `✓` 或 `✗`
4. 可点击展开查看详情

### 7.3 微交互设计

克制但有温度的动效，提升体验而不分散注意力。

#### 允许的动效

| 场景 | 动效 | 参数 |
|------|------|------|
| 消息出现 | 淡入 + 微上移 | `opacity 0→1, translateY 8px→0, 150ms ease-out` |
| 按钮悬停 | 背景色变化 | `background-color 100ms` |
| 输入框聚焦 | 边框色变化 | `border-color 100ms` |
| 工具状态变化 | 图标颜色变化 | `color 100ms` |
| 流式输出 | 光标闪烁 | `opacity 0↔1, 530ms` |
| 侧边栏展开/折叠 | 宽度变化 | `width 200ms ease-out` |
| 下拉菜单 | 淡入 + 微下移 | `opacity 0→1, translateY -4px→0, 100ms` |

#### 禁止的动效

- 弹跳、回弹效果
- 旋转、缩放动画
- 复杂的路径动画
- 持续时间 > 300ms 的动画
- 纯装饰性动画

#### CSS 变量

```css
:root {
  --transition-fast: 100ms ease-out;
  --transition-normal: 150ms ease-out;
  --transition-slow: 200ms ease-out;
}

---

## 8. 状态设计

### 8.1 空状态

空状态是用户的第一印象，需要友好且有引导性。

#### 无会话（首次使用）

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│                         ◉ SanBot                             │
│                                                              │
│                   Hi, I'm your coding assistant.             │
│                                                              │
│     ┌─────────────────────────────────────────────────┐      │
│     │  Try asking me to:                              │      │
│     │                                                 │      │
│     │  • "分析这个项目的结构"                          │      │
│     │  • "帮我写一个 React 组件"                       │      │
│     │  • "运行测试并修复失败的用例"                     │      │
│     └─────────────────────────────────────────────────┘      │
│                                                              │
│                    [+ Start a new chat]                      │
│                         or press ⌘N                          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

- 居中显示，有呼吸感
- 提供示例引导，降低使用门槛
- 同时提供按钮和快捷键两种方式

#### 会话无消息

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│                                                              │
│                    How can I help you today?                 │
│                                                              │
│              Type a message below to get started             │
│                                                              │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

- 简洁友好的问候
- 引导用户输入

### 8.2 加载状态

```
SanBot                                               10:30 AM
Thinking...▌
```

- 简单文字提示 + 闪烁光标
- 光标闪烁提供"正在工作"的视觉反馈
- 无骨架屏，保持简洁

### 8.3 错误状态

#### 连接错误

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│              Connection lost. Reconnecting...                │
│                                                              │
│                      [Retry Now]                             │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 消息发送失败

```
You                                                  10:30 AM
重构 WebUI
                                        Failed to send. Retry?
```

- 错误信息内联显示
- 提供重试选项

---

## 9. 响应式设计

### 9.1 断点

```
Desktop:  ≥ 768px   完整布局
Mobile:   < 768px   隐藏侧边栏，全屏对话
```

### 9.2 移动端适配

- 侧边栏默认隐藏，通过汉堡菜单打开
- 输入框固定在底部
- 工具调用默认折叠
- 字号保持不变（不放大）

---

## 10. 技术实现

### 10.1 技术栈

| 层面 | 选择 |
|------|------|
| 框架 | 纯 HTML/CSS/JS |
| 样式 | CSS Variables |
| 通信 | WebSocket |
| 字体 | Geist (CDN) |
| 图标 | 纯文字符号 |

### 10.2 文件结构

```
src/web/static/
└── index.html    # 单文件，内联 CSS/JS
```

保持单文件，便于部署和维护。

### 10.3 性能目标

- 首屏加载 < 100KB
- 无外部依赖（除字体）
- 支持 500+ 条消息不卡顿

---

## 11. 实现清单

### Phase 1: 核心

- [ ] 基础布局（Header + Sidebar + Main + Input）
- [ ] 消息展示（用户/AI）
- [ ] 工具调用展示
- [ ] WebSocket 通信

### Phase 2: 交互

- [ ] 键盘快捷键
- [ ] 会话管理（新建/切换/删除）
- [ ] 模型选择器
- [ ] 工具详情展开

### Phase 3: 完善

- [ ] 空状态/错误状态
- [ ] 移动端适配
- [ ] 连接状态管理
- [ ] 消息重试

---

*文档版本: v3.1*
*设计风格: 现代、克制、有温度*
*最后更新: 2026-02-06*
