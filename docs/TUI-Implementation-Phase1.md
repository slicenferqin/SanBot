# TUI é˜¶æ®µä¸€å®ç°æ€»ç»“

## å®æ–½æ—¥æœŸ
2026-02-03

## å®ç°çš„åŠŸèƒ½

### âœ… Feature 1: æµå¼è¾“å‡º (Streaming)

**çŠ¶æ€**: å·²å®Œæˆ

**å®ç°å†…å®¹**:
- åˆ›å»ºäº† `src/tui/stream.ts` æ¨¡å—ï¼Œå®ç° `StreamWriter` ç±»
- åœ¨ `Agent` ç±»ä¸­æ·»åŠ äº† `chatStream()` æ–¹æ³•
- å®ç°äº† Anthropic SDK çš„æµå¼è¾“å‡º (`chatWithAnthropicStream`)
- å®ç°äº† OpenAI å…¼å®¹ API çš„æµå¼è¾“å‡º (`chatWithOpenAIStream`)
- ä¿®æ”¹ `src/index.ts` ä½¿ç”¨æµå¼è¾“å‡ºæ›¿ä»£åŸæœ‰çš„é˜»å¡å¼è¾“å‡º

**æŠ€æœ¯ç»†èŠ‚**:
- Anthropic: ä½¿ç”¨ `client.messages.stream()` API
- OpenAI: ä½¿ç”¨ AI SDK çš„ `streamText()` å‡½æ•°
- æµå¼æ–‡æœ¬é€šè¿‡ `StreamWriter` å®æ—¶å†™å…¥ç»ˆç«¯
- æ”¯æŒå·¥å…·è°ƒç”¨æ—¶æš‚åœæµå¼ï¼Œå·¥å…·å®Œæˆåç»§ç»­

**éªŒæ”¶æ ‡å‡†**:
- [x] æ–‡æœ¬å“åº”å®æ—¶æ˜¾ç¤º
- [x] å·¥å…·è°ƒç”¨æ—¶æš‚åœæµå¼ï¼Œæ˜¾ç¤ºå·¥å…·çŠ¶æ€
- [x] å·¥å…·å®Œæˆåç»§ç»­æµå¼æ˜¾ç¤ºåç»­å†…å®¹

---

### âœ… Feature 2: å·¥å…·è°ƒç”¨çŠ¶æ€æ˜¾ç¤º

**çŠ¶æ€**: å·²å®Œæˆ

**å®ç°å†…å®¹**:
- åˆ›å»ºäº† `src/tui/spinner.ts` æ¨¡å—ï¼Œå®ç° `ToolSpinner` ç±»
- ä½¿ç”¨ `nanospinner` åº“å®ç°åŠ¨æ€ spinner åŠ¨ç”»
- ä½¿ç”¨ `picocolors` åº“å®ç°å½©è‰²è¾“å‡º
- æ˜¾ç¤ºå·¥å…·åç§°ã€å‚æ•°æ‘˜è¦ã€æ‰§è¡Œæ—¶é—´å’ŒçŠ¶æ€

**æ˜¾ç¤ºæ•ˆæœ**:
```
ğŸ”§ Calling list_dir...
âœ… list_dir completed (1ms)

ğŸ”§ Calling read_file...
âœ… read_file completed (0ms)
```

**æŠ€æœ¯ç»†èŠ‚**:
- è‡ªåŠ¨æ£€æµ‹ TTY ç¯å¢ƒï¼Œé TTY ç¯å¢ƒé™çº§ä¸ºç®€å•æ–‡æœ¬è¾“å‡º
- ç²¾ç¡®è®¡æ—¶å·¥å…·æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’/ç§’ï¼‰
- æ”¯æŒæˆåŠŸ/å¤±è´¥çŠ¶æ€æ˜¾ç¤º
- å‚æ•°æ‘˜è¦è‡ªåŠ¨æˆªæ–­é•¿å­—ç¬¦ä¸²ï¼ˆæœ€å¤š 50 å­—ç¬¦ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- [x] å·¥å…·è°ƒç”¨æ—¶æ˜¾ç¤ºåŠ¨æ€ spinner
- [x] æ˜¾ç¤ºå·¥å…·åç§°å’Œå…³é”®å‚æ•°
- [x] å®Œæˆåæ˜¾ç¤ºè€—æ—¶å’ŒçŠ¶æ€

---

## æ–‡ä»¶ç»“æ„

æ–°å¢æ–‡ä»¶ï¼š
```
src/tui/
â”œâ”€â”€ index.ts        # TUI æ¨¡å—å¯¼å‡º
â”œâ”€â”€ spinner.ts      # Spinner ç»„ä»¶ï¼ˆå·¥å…·è°ƒç”¨çŠ¶æ€ï¼‰
â””â”€â”€ stream.ts       # æµå¼è¾“å‡ºå¤„ç†
```

ä¿®æ”¹æ–‡ä»¶ï¼š
- `src/agent.ts` - æ·»åŠ æµå¼èŠå¤©æ–¹æ³•
- `src/index.ts` - é›†æˆæµå¼è¾“å‡º

---

## ä¾èµ–å˜æ›´

æ–°å¢ä¾èµ–ï¼š
```json
{
  "nanospinner": "^1.2.2",
  "picocolors": "^1.1.1"
}
```

---

## æµ‹è¯•ç»“æœ

### æµ‹è¯•åœºæ™¯ 1: ç®€å•æ–‡æœ¬å“åº”
```bash
$ sanbot "What is 2+2? Just answer."
ğŸ¤– SanBot is thinking...

ğŸ“¦ Loaded 6 custom tools from registry
4

âœ… Done!
```
âœ… æµå¼è¾“å‡ºæ­£å¸¸

### æµ‹è¯•åœºæ™¯ 2: å•ä¸ªå·¥å…·è°ƒç”¨
```bash
$ sanbot "use read_file to read package.json"
ğŸ¤– SanBot is thinking...

ğŸ“¦ Loaded 6 custom tools from registry
ğŸ”§ Calling read_file...
âœ… read_file completed (1ms)
[å“åº”å†…å®¹...]

âœ… Done!
```
âœ… Spinner æ˜¾ç¤ºæ­£å¸¸

### æµ‹è¯•åœºæ™¯ 3: å¤šä¸ªå·¥å…·è°ƒç”¨
```bash
$ sanbot "use list_dir to list src directory, then use read_file to read src/index.ts first 20 lines"
ğŸ¤– SanBot is thinking...

ğŸ“¦ Loaded 6 custom tools from registry
I'll list the src directory first, then read the first 20 lines of src/index.ts.
ğŸ”§ Calling list_dir...
âœ… list_dir completed (1ms)
ğŸ”§ Calling read_file...
âœ… read_file completed (0ms)
[å“åº”å†…å®¹...]

âœ… Done!
```
âœ… å¤šå·¥å…·è°ƒç”¨é¡ºåºæ­£ç¡®

---

## å·²çŸ¥é—®é¢˜

### 1. ~~æ—¶é—´æ˜¾ç¤ºé”™è¯¯~~
**çŠ¶æ€**: å·²ä¿®å¤

**é—®é¢˜**: é TTY ç¯å¢ƒä¸‹ï¼Œ`startTime` æœªåˆå§‹åŒ–å¯¼è‡´æ—¶é—´æ˜¾ç¤ºå¼‚å¸¸ï¼ˆå¦‚ 1770098323.4sï¼‰

**è§£å†³æ–¹æ¡ˆ**: å°† `this.startTime = Date.now()` ç§»åˆ° TTY æ£€æµ‹ä¹‹å‰

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

æ ¹æ® TUI é‡æ„è®¡åˆ’ï¼Œä¸‹ä¸€é˜¶æ®µï¼ˆé˜¶æ®µäºŒï¼‰å°†å®ç°ï¼š

### P1 åŠŸèƒ½ï¼š
1. **å½©è‰²è¾“å‡ºç³»ç»Ÿ** - ä¸åŒç±»å‹ä¿¡æ¯ç”¨ä¸åŒé¢œè‰²åŒºåˆ†
2. **è¾“å‡ºæ ¼å¼åŒ–** - Markdown æ¸²æŸ“ã€ä»£ç å—é«˜äº®
3. **é”™è¯¯å¤„ç†ç¾åŒ–** - å‹å¥½çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®

### æŠ€æœ¯é€‰å‹ï¼š
- é¢œè‰²: `picocolors` (å·²å®‰è£…) âœ…
- Markdown: `marked-terminal` æˆ– `marked` + `cli-highlight`
- ä»£ç é«˜äº®: `cli-highlight` æˆ– `prism`

---

## æ€»ç»“

é˜¶æ®µä¸€çš„ä¸¤ä¸ª P0 åŠŸèƒ½å·²å…¨éƒ¨å®Œæˆå¹¶æµ‹è¯•é€šè¿‡ï¼š

âœ… **æµå¼è¾“å‡º** - ç”¨æˆ·å¯ä»¥å®æ—¶çœ‹åˆ° AI çš„å“åº”ï¼Œä¸å†éœ€è¦ç­‰å¾…å…¨éƒ¨å®Œæˆ  
âœ… **å·¥å…·è°ƒç”¨çŠ¶æ€æ˜¾ç¤º** - æ¸…æ™°æ˜¾ç¤ºå·¥å…·è°ƒç”¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬åç§°ã€è€—æ—¶å’ŒçŠ¶æ€

è¿™ä¸¤ä¸ªåŠŸèƒ½æ˜¾è‘—æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œä»"èƒ½ç”¨"å‘"å¥½ç”¨"è¿ˆè¿›äº†ä¸€å¤§æ­¥ã€‚

**ç”¨æˆ·ä½“éªŒæ”¹è¿›**:
- â±ï¸ å‡å°‘ç­‰å¾…ç„¦è™‘ - å®æ—¶çœ‹åˆ°å“åº”
- ğŸ‘ï¸ æé«˜é€æ˜åº¦ - æ¸…æ¥šçŸ¥é“ AI åœ¨åšä»€ä¹ˆ
- ğŸ¯ å¢å¼ºåé¦ˆ - å·¥å…·è°ƒç”¨çŠ¶æ€ä¸€ç›®äº†ç„¶
